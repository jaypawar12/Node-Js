<%- include('../header') %>
    <style>
        .transform-on-hover {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
        }

        .transform-on-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.2) !important;
        }

        .card-img-top.rounded-lg {
            border-radius: 0.5rem !important;
            border-bottom-left-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }

        .badge.rounded-pill {
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .modal-footer .btn {
            transition: all 0.2s ease-in-out;
        }

        .modal-footer .btn-outline-dark:hover {
            background-color: var(--bs-dark);
            color: white;
        }

        .modal-footer .btn-outline-danger:hover {
            background-color: var(--bs-danger);
            color: white;
        }

        .alert-info {
            background-color: #e0f7fa;
            border-color: #b2ebf2;
            color: #006064;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }

        .category-card img {
            width: 100%;
            display: block;
        }
    </style>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <h4 class="fw-bold text-dark mb-0">
                <i class="fas fa-th-list me-2"></i>All Categories
            </h4>
            <a href="/category/addCategoryPage" class="btn btn-dark btn-md shadow-sm">
                <i class="fas fa-plus-circle me-2"></i>Add New Category
            </a>
        </div>

        <div class="row">
            <% if (categories.length> 0) { %>
                <% categories.forEach((cat)=> { %>
                    <div class="col-md-3  d-flex align-items-stretch">
                        <div class="card shadow-lg h-100 border-0 transform-on-hover category-card"
                            data-bs-toggle="modal" data-bs-target="#categoryDetailModal"
                            data-category-id="<%= cat._id %>" data-category-name="<%= cat.category_name %>"
                            data-category-description="<%= cat.category_description %>"
                            data-category-status="<%= cat.category_status %>"
                            data-category-image="../<%= cat.category_image %>">
                            <img src="../<%= cat.category_image %>" class="card-img-top rounded-lg cursor-pointer"
                                style="height: 200px; object-fit: cover;" alt="<%= cat.category_name %> Image">
                            <div class="card-body d-flex align-items-center justify-content-center p-2">
                                <h5 class="card-title fw-bold text-dark text-center mb-0">
                                    <%= cat.category_name %>
                                </h5>
                            </div>
                        </div>
                    </div>
                    <% }); %>
                        <% } else { %>
                            <div class="col-12 text-center py-5">
                                <div class="alert alert-info d-inline-flex align-items-center" role="alert">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <h5 class="mb-0">No categories found.</h5>
                                </div>
                            </div>
                            <% } %>
        </div>

        <div class="modal fade" id="categoryDetailModal" tabindex="-1" aria-labelledby="categoryDetailModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-gradient-dark">
                        <h5 class="modal-title text-white" id="categoryDetailModalLabel">Category Details</h5>
                        <button type="button" class="btn-close text-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row">
                            <div class="col-md-6 text-center">
                                <img id="modalCategoryImage" src="" alt="Category Image"
                                    class="img-fluid rounded shadow-sm mb-3"
                                    style="max-height: 300px; object-fit: cover;">
                            </div>
                            <div class="col-md-6 d-flex flex-column justify-content-center">
                                <h3 class="fw-bold text-dark" id="modalCategoryName"></h3>
                                <p class="text-muted" id="modalCategoryDescription"></p>
                                <p class="mb-3">Status: <span id="modalCategoryStatus"
                                        class="badge px-3 py-2 text-uppercase fw-bold"></span></p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-end bg-light p-3">
                        <a href="#" id="modalEditButton" class="btn btn-outline-dark me-2 rounded-pill">
                            <i class="fas fa-edit me-1"></i>Edit Category
                        </a>
                        <a href="#" id="modalDeleteButton" class="btn btn-outline-danger rounded-pill"
                            onclick="return confirm('Are you sure you want to delete this category? This action cannot be undone.');">
                            <i class="fas fa-trash-alt me-1"></i>Delete Category
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <%- include('../footer') %>



            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const categoryDetailModal = document.getElementById('categoryDetailModal');
                    categoryDetailModal.addEventListener('show.bs.modal', function (event) {
                        // Button that triggered the modal
                        const button = event.relatedTarget;

                        // Extract info from data-* attributes
                        const categoryId = button.getAttribute('data-category-id');
                        const categoryName = button.getAttribute('data-category-name');
                        const categoryDescription = button.getAttribute('data-category-description');
                        const categoryStatus = button.getAttribute('data-category-status');
                        const categoryImage = button.getAttribute('data-category-image');

                        // Update the modal's content.
                        const modalTitle = categoryDetailModal.querySelector('.modal-title');
                        const modalImage = categoryDetailModal.querySelector('#modalCategoryImage');
                        const modalName = categoryDetailModal.querySelector('#modalCategoryName');
                        const modalDescription = categoryDetailModal.querySelector('#modalCategoryDescription');
                        const modalStatus = categoryDetailModal.querySelector('#modalCategoryStatus');
                        const modalEditButton = categoryDetailModal.querySelector('#modalEditButton');
                        const modalDeleteButton = categoryDetailModal.querySelector('#modalDeleteButton');

                        modalTitle.textContent = categoryName;
                        modalImage.src = categoryImage;
                        modalName.textContent = categoryName;
                        modalDescription.textContent = categoryDescription;
                        modalStatus.textContent = categoryStatus;

                        // Update status badge class
                        modalStatus.classList.remove('bg-success', 'bg-danger');
                        if (categoryStatus === 'Active') {
                            modalStatus.classList.add('bg-success');
                        } else {
                            modalStatus.classList.add('bg-danger');
                        }

                        // Update button hrefs
                        modalEditButton.href = `/category/editCategoryPage/${categoryId}`;
                        modalDeleteButton.href = `/category/deleteCategory/${categoryId}`;
                    });
                });
            </script>